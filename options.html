<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Python Library" href="library.html" /><link rel="prev" title="Flatterer. Making JSON flatterer" href="index.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Option Reference - flatterer 0.19 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">flatterer 0.19 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">flatterer 0.19 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Option Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">Python Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="s3.html">S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="web.html">Web Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="option-reference">
<h1>Option Reference<a class="headerlink" href="#option-reference" title="Permalink to this heading">#</a></h1>
<section id="help-small-cli-only-small">
<h2>Help <small> (CLI Only) </small><a class="headerlink" href="#help-small-cli-only-small" title="Permalink to this heading">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--help
</pre></div>
</div>
<p>output looks like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Usage: flatterer [OPTIONS] [INPUTS]... OUTPUT_DIRECTORY

Options:
  --web                       Load web based version
  --csv / --nocsv             Output CSV files, default true
  --xlsx / --noxlsx           Output XLSX file, default false
  --sqlite / --nosqlite       Output sqlite.db file, default false
  --parquet / --noparquet     Output directory of parquet files, default false
  --postgres TEXT             Connection string to postgres. If supplied will
                              load data into postgres
  --sqlite-path TEXT          Output sqlite file to this file
  -d, --pushdown TEXT         Object keys and values, with this key name, will
                              be copied down to child tables
  -n, --no-link               Do not create `_link` fields
  -m, --main-table-name TEXT  Name of main table, defaults to name of the file
                              without the extension
  -p, --path TEXT             Key name of where json array starts, default top
                              level array
  -j, --ndjson                Is file a new line delemited JSON file, default
                              false
  --json-stream               File contains stream of json object, default
                              false
  --force                     Delete output directory if it exists, then run
                              command, default False
  -f, --fields TEXT           fields.csv file to use
  -o, --only-fields           Only output fields in fields.csv file
  -b, --tables TEXT           tables.csv file to use
  -l, --only-tables           Only output tables in tables.csv file
  -i, --inline-one-to-one     If array only has single item for all objects
                              treat as one-to-one
  -y, --arrays-new-table      Always treat arrays as a new tables, even when
                              they contain items that are not objects
  -s, --schema TEXT           JSONSchema file or URL to determine field order
  -t, --table-prefix TEXT     Prefix to add to all table names
  -a, --path-separator TEXT   Seperator to denote new path within the input
                              JSON. Defaults to `_`
  -h, --schema-titles TEXT    Use titles from JSONSchema in the given way.
                              Options are `full`, `slug`, `underscore_slug`.
                              Default to not using titles
  -w, --preview INTEGER       Only output this `preview` amount of lines in
                              final results
  --threads INTEGER           Number of threads, default 1, 0 means use number
                              of CPUs
  --json-path TEXT            JSON path within each object to use to filter
                              which objects to select
  --postgres-schema TEXT      When loading to postgres, put all tables into
                              this schema.
  --evolve                    When loading to postgres or sqlite, evolve
                              tables to fit data
  --drop                      When loading to postgres or sqlite, drop table
                              if already exists.
  --truncate                  When loading to postgres or sqlite, truncate table
                              if already exists.
  --id-prefix TEXT            Prefix for all `_link` id fields
  --stats                     Produce stats about the data in the
                              datapackage.json file
  --help                      Show this message and exit.
</pre></div>
</div>
</section>
<section id="output-formats">
<h2>Output Formats<a class="headerlink" href="#output-formats" title="Permalink to this heading">#</a></h2>
<p><strong>CSV:</strong>  Defaults to outputing CSV in output directory <code class="docutils literal notranslate"><span class="pre">&lt;OUTPUT_DIRECTORY&gt;/csv/</span></code>.</p>
<p><strong>XLSX:</strong>  Output xlsx file to <code class="docutils literal notranslate"><span class="pre">&lt;OUTPUT_DIRECTORY&gt;/output.xlsx</span></code>.</p>
<p><strong>SQLITE:</strong>  Output sqlite file to  <code class="docutils literal notranslate"><span class="pre">&lt;OUTPUT_DIRECTORY&gt;/sqlite.db</span></code>.</p>
<p><strong>PARQUET:</strong>  Output parquet files in <code class="docutils literal notranslate"><span class="pre">&lt;OUTPUT_DIRECTORY&gt;/parquet/</span></code>.</p>
<p><strong>POSTGRES:</strong>  Output in database.</p>
<section id="cli-usage">
<h3>CLI Usage<a class="headerlink" href="#cli-usage" title="Permalink to this heading">#</a></h3>
<p><strong>Stop CSV output:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--nocsv<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY
</pre></div>
</div>
<p><strong>xlsx output:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--xlsx<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY
</pre></div>
</div>
<p><strong>sqlite output:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--sqlite<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY
</pre></div>
</div>
<p><strong>parquet output:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--parquet<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY
</pre></div>
</div>
<p><strong>postgres output:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--postgres<span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY
</pre></div>
</div>
<p>The connection string should be in <a class="reference external" href="https://docs.rs/postgres/latest/postgres/config/struct.Config.html#examples">one of these formats</a>. In addition, if you want the connection string from an environment variable then use the string <code class="docutils literal notranslate"><span class="pre">env</span></code> (for default DATABASE_URL enviroment variable) <code class="docutils literal notranslate"><span class="pre">env=MY_ENV_VAR</span></code> (for MY_ENV_VAR environment variable).</p>
<p><strong>postgres output from envirment variable:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--postgres<span class="o">=</span><span class="s1">&#39;env=MY_ENV_VAR&#39;</span><span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY
</pre></div>
</div>
<p>This will get the connection string from the <code class="docutils literal notranslate"><span class="pre">MY_ENV_VAR</span></code> environment variable.</p>
</section>
<section id="python-usage">
<h3>Python Usage<a class="headerlink" href="#python-usage" title="Permalink to this heading">#</a></h3>
<p>Export sqlite, xlsx, and parquet but not CSV.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>import<span class="w"> </span>flatterer

flatterer.flatten<span class="o">(</span><span class="s1">&#39;inputfile.json&#39;</span>,<span class="w"> </span><span class="s1">&#39;ouput_dir&#39;</span>,<span class="w"> </span><span class="nv">csv</span><span class="o">=</span>False,<span class="w"> </span><span class="nv">sqlite</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">xlsx</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">parquet</span><span class="o">=</span>True,<span class="w"> </span><span class="nv">postgres</span><span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="o">)</span>
</pre></div>
</div>
</section>
</section>
<section id="main-table-name">
<h2>Main Table Name<a class="headerlink" href="#main-table-name" title="Permalink to this heading">#</a></h2>
<p>Name of the table that represents data at the root of the JSON object.</p>
<p>For CSV will create <code class="docutils literal notranslate"><span class="pre">&lt;OUTPUT_DIRECTORY&gt;/csv/&lt;main_table_name&gt;.csv</span></code> and for XLSX will be the first tab name.</p>
<p>For CLI defaults to name of input file without the file ending and for python defaults to <code class="docutils literal notranslate"><span class="pre">main</span></code>.</p>
<section id="id1">
<h3>CLI Usage<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>-m<span class="w"> </span>games<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY
</pre></div>
</div>
</section>
<section id="id2">
<h3>Python Usage<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">main_table_name</span><span class="o">=</span><span class="s1">&#39;games&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="pushdown-fields">
<h2>Pushdown Fields<a class="headerlink" href="#pushdown-fields" title="Permalink to this heading">#</a></h2>
<p>This allows you to copy values from top level object down to the child tables.  This is useful if you want to define your own join keys or if it is useful having certain values in all related tables, saving you doing extra joins for common queries.</p>
<p>You need to specify a list of fields names (keys in the JSON) that you want to appear on all one-to-many tables (child tables). The field will prefixed with the table name where the field existed and the value will be copied from that table.</p>
<p>For example if <code class="docutils literal notranslate"><span class="pre">main_table_name</span></code> is <code class="docutils literal notranslate"><span class="pre">game</span></code> and this is the input JSON:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;platforms&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;PC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;requirements&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span><span class="s2">&quot;ram&quot;</span><span class="p">:</span> <span class="s2">&quot;4GB&quot;</span><span class="p">}</span>
        <span class="p">]</span> 
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<section id="id3">
<h3>CLI Usage<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<p>If <code class="docutils literal notranslate"><span class="pre">id</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code> are pushdown fields:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>-d<span class="w"> </span>id<span class="w"> </span>-d<span class="w"> </span>name
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">platforms</span></code> table will contain:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>_link</p></th>
<th class="head"><p>_link_game</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>id</p></th>
<th class="head"><p>game_id</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.platforms.0</p></td>
<td><p>0</p></td>
<td><p>PC</p></td>
<td><p>1</p></td>
<td><p>4</p></td>
</tr>
</tbody>
</table>
</div>
<p>As you can see a new column <code class="docutils literal notranslate"><span class="pre">game_id</span></code> is created containing the <code class="docutils literal notranslate"><span class="pre">id</span></code> from the <code class="docutils literal notranslate"><span class="pre">games</span></code> object.</p>
<p><code class="docutils literal notranslate"><span class="pre">platforms_requirements</span></code> table will contain:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>_link</p></th>
<th class="head"><p>_link_platforms</p></th>
<th class="head"><p>_link_game</p></th>
<th class="head"><p>platforms_name</p></th>
<th class="head"><p>platforms_id</p></th>
<th class="head"><p>game_id</p></th>
<th class="head"><p>ram</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.platforms.0.requirements.0</p></td>
<td><p>0.platforms.0</p></td>
<td><p>0</p></td>
<td><p>PC</p></td>
<td><p>1</p></td>
<td><p>4</p></td>
<td><p>4GB</p></td>
</tr>
</tbody>
</table>
</div>
<p>This table also contains <code class="docutils literal notranslate"><span class="pre">game_id</span></code> but also <code class="docutils literal notranslate"><span class="pre">platforms_id</span></code> as <code class="docutils literal notranslate"><span class="pre">id</span></code> is pushed down from both parent tables.  Also as <code class="docutils literal notranslate"><span class="pre">name</span></code> is a pushdown field, <code class="docutils literal notranslate"><span class="pre">platforms_name</span></code> column is also created.</p>
</section>
<section id="id4">
<h3>Python Usage<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">pushdown</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
</section>
<section id="no-link-fields">
<h2>No Link Fields<a class="headerlink" href="#no-link-fields" title="Permalink to this heading">#</a></h2>
<p>Do not create any <code class="docutils literal notranslate"><span class="pre">_link</span></code> fields. This could be useful if <code class="docutils literal notranslate"><span class="pre">pushdown</span></code> pushes ids into
child tables and you trust that this will be sufficient to link the tables back together.</p>
<section id="id5">
<h3>CLI Usage<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>-n
</pre></div>
</div>
</section>
<section id="id6">
<h3>Python Usage<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">pushdown</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">no_link</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="path-to-json-array">
<h2>Path to JSON Array<a class="headerlink" href="#path-to-json-array" title="Permalink to this heading">#</a></h2>
<p>Name of the object key where array of objects exists. Defaults to analysing the top level array.</p>
<p>Will not work with <a class="reference internal" href="#json-stream"><span class="std std-doc">JSON Stream</span></a> or <span class="xref myst"></span> option.</p>
<p>By default will work with:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A Game&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2015-01-01&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;B Game&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2016-01-01&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>If set to <code class="docutils literal notranslate"><span class="pre">games</span></code> will work with JSON like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;games&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A Game&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2015-01-01&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;B Game&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2016-01-01&quot;</span>
<span class="p">]}</span>
</pre></div>
</div>
<section id="id7">
<h3>CLI Usage<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>-p<span class="w"> </span>games
</pre></div>
</div>
</section>
<section id="id8">
<h3>Python Usage<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;games&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="new-line-delemited-json-ndjson">
<h2>New Line Delemited JSON (NDJSON)<a class="headerlink" href="#new-line-delemited-json-ndjson" title="Permalink to this heading">#</a></h2>
<p>Input file is new line delimeted JSON.  This is the fastest input type as each line can be parsed in its own thread using <code class="docutils literal notranslate"><span class="pre">--threads</span></code>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A Game&quot;</span><span class="p">,</span><span class="w">  </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2015-01-01&quot;</span><span class="p">}</span>
<span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;B Game&quot;</span><span class="p">,</span><span class="w">  </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2016-01-01&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Will not work with <a class="reference internal" href="#path-to-json-array"><span class="std std-doc">Path to JSON Array</span></a> option.</p>
<section id="id9">
<h3>CLI Usage<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--ndjson
</pre></div>
</div>
</section>
<section id="id10">
<h3>Python Usage<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">ndjson</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="json-stream">
<h2>JSON Stream<a class="headerlink" href="#json-stream" title="Permalink to this heading">#</a></h2>
<p>Input file is stream of json objects, sometimes called Concatonated JSON.  Each object does not need to be on its own line.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A Game&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2015-01-01&quot;</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;B Game&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;releaseDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2016-01-01&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Will not work with <a class="reference internal" href="#path-to-json-array"><span class="std std-doc">Path to JSON Array</span></a> option.</p>
<section id="id11">
<h3>CLI Usage<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--json-stream
</pre></div>
</div>
</section>
<section id="id12">
<h3>Python Usage<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">json_stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="json-path-filter">
<h2>JSON Path Filter<a class="headerlink" href="#json-path-filter" title="Permalink to this heading">#</a></h2>
<p>This is used for filtering out objects to be included in the output, not for selecting values within an object.</p>
<p>Use a [JSON path][https://goessner.net/articles/JsonPath/] expression to select if a particular object will be in output.</p>
<p>Flatterer will evaluate the JSON path expression against every object in the input, and if there is any non-null value, it will include that object in the result.</p>
<p>e.g</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A Film&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;film&quot;</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A Game&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;game&quot;</span>
<span class="p">}]</span>
</pre></div>
</div>
<p>Using the above input JSON the following will only select object with <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">game</span></code> (only select the second object in the example).</p>
<section id="id13">
<h3>CLI Usage<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># careful as the $ needs escaping</span>
flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--json-path<span class="w"> </span><span class="s2">&quot;\$[?(@.type == &#39;game&#39;)]]&quot;</span><span class="w"> </span>
</pre></div>
</div>
</section>
<section id="id14">
<h3>Python Usage<a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">json_path</span><span class="o">=</span><span class="s2">&quot;$[?(@.type == &#39;game&#39;)]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>More complicated expressions can be used including logical conditions so <code class="docutils literal notranslate"><span class="pre">$[?(&#64;.type</span> <span class="pre">==</span> <span class="pre">'game'</span> <span class="pre">||</span> <span class="pre">&#64;.type</span> <span class="pre">==</span> <span class="pre">'film')]</span></code> will select objects with either <code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">'game'</span> <span class="pre">OR</span> <span class="pre">type</span> <span class="pre">=</span> <span class="pre">'film'</span></code>.</p>
</section>
</section>
<section id="force">
<h2>Force<a class="headerlink" href="#force" title="Permalink to this heading">#</a></h2>
<p>Delete the output folder if it exists before processing.</p>
<section id="id15">
<h3>CLI Usage<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--force
</pre></div>
</div>
</section>
<section id="id16">
<h3>Python Usage<a class="headerlink" href="#id16" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="postgres-schema">
<h2>Postgres Schema<a class="headerlink" href="#postgres-schema" title="Permalink to this heading">#</a></h2>
<p>Put tables into a postgres schema. Will create schema if it does not already exist.</p>
<section id="id17">
<h3>CLI Usage<a class="headerlink" href="#id17" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--postgres<span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--postgres-schema<span class="o">=</span>myschema
</pre></div>
</div>
</section>
<section id="id18">
<h3>Python Usage<a class="headerlink" href="#id18" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">postgres</span><span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="p">,</span> <span class="n">postgres_schema</span><span class="o">=</span><span class="s1">&#39;myschema&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="evolve-tables">
<h2>Evolve Tables<a class="headerlink" href="#evolve-tables" title="Permalink to this heading">#</a></h2>
<p>For postgres and sqlite. This will evolve the existing tables if the schema of the new flattened data is different. This is useful if you have new JSON data that comes in over time or you have lots of files you want to process one by one.</p>
<p>Evolving follows the following rules:</p>
<ul class="simple">
<li><p>If the new flattened data contains a table that does not exist in the database it will created.</p></li>
<li><p>If the table already exists but the new data has extra fields, the table is altered to add the new fields.</p></li>
<li><p>If table exists but fields that are in the database are not in the new data, they will result in nulls in the database when the new data is inserted.</p></li>
<li><p>If table exists and contains the same field name as the new data but the data types of the fields conflict:</p>
<ul>
<li><p>For postgres the field is altered to being a <code class="docutils literal notranslate"><span class="pre">text</span></code> field so that both new and old data can exist (all types can be coerced to text).</p></li>
<li><p>For sqlite, as you can not alter existing types, the original type is kept. This will mean the data insertion will still work as sqlite treats any field as if it is text.</p></li>
</ul>
</li>
<li><p>If no <code class="docutils literal notranslate"><span class="pre">id_prefix</span></code> is supplied random string will be added to <code class="docutils literal notranslate"><span class="pre">_link</span></code> fields so that these ids will be unique across loads.</p></li>
</ul>
<p>It is recommended to add an <code class="docutils literal notranslate"><span class="pre">id_prefix</span></code> that is unique for each JSON file load. It could conatain for example the name of the file or a date.</p>
<p><strong>Warning: this could mean you modify existing data.</strong></p>
<p><strong>Warning: Not completely parallel safe if multiple processes are inserting data into same database, it may cause an error if two processes are trying to add the same new field. This will not currupt any data and a retry should work.</strong></p>
<section id="id19">
<h3>CLI Usage<a class="headerlink" href="#id19" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--postgres<span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--evolve
</pre></div>
</div>
</section>
<section id="id20">
<h3>Python Usage<a class="headerlink" href="#id20" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">postgres</span><span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="p">,</span> <span class="n">evolve</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="drop-tables">
<h2>Drop Tables<a class="headerlink" href="#drop-tables" title="Permalink to this heading">#</a></h2>
<p><strong>Warning: this could mean you loose data</strong></p>
<p>For postgres and sqlite. Drop the existing table if it exists.</p>
<section id="id21">
<h3>CLI Usage<a class="headerlink" href="#id21" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--postgres<span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="w"> </span>--sqlite-path<span class="o">=</span>sqlite.db<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--drop
</pre></div>
</div>
</section>
<section id="id22">
<h3>Python Usage<a class="headerlink" href="#id22" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">postgres</span><span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="truncate-tables">
<h2>Truncate Tables<a class="headerlink" href="#truncate-tables" title="Permalink to this heading">#</a></h2>
<p><strong>Warning: this could mean you loose data</strong></p>
<p>For postgres and sqlite. Truncate the existing table if it exists. This is useful if you want to load the data into a databse with the schema pre-defined.</p>
<section id="id23">
<h3>CLI Usage<a class="headerlink" href="#id23" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>--postgres<span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="w"> </span>--sqlite-path<span class="o">=</span>sqlite.db<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--truncate
</pre></div>
</div>
</section>
<section id="id24">
<h3>Python Usage<a class="headerlink" href="#id24" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">postgres</span><span class="o">=</span><span class="s1">&#39;postgres://user:pass@host/dbname&#39;</span><span class="p">,</span> <span class="n">truncate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="fields-file">
<h2>Fields File<a class="headerlink" href="#fields-file" title="Permalink to this heading">#</a></h2>
<p>Path to fields CSV file.  The fields file can be used for:</p>
<ul class="simple">
<li><p>Changing the field order in output files by rearranging the rows in the correct order.</p></li>
<li><p>Giving the fields a new name by using <code class="docutils literal notranslate"><span class="pre">field_title</span></code></p></li>
<li><p>Removing unwanted fields when using the <a class="reference internal" href="#only-fields"><span class="std std-doc">Only Fields</span></a> option.</p></li>
</ul>
<p>The CSV file needs the following headers:</p>
<ul class="simple">
<li><p>table_name</p></li>
<li><p>field_name</p></li>
</ul>
<p>It has the optional heading of <code class="docutils literal notranslate"><span class="pre">field_title</span></code> which will default to the <code class="docutils literal notranslate"><span class="pre">field_name</span></code> if missing.</p>
<p>For example:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>table_name</p></th>
<th class="head"><p>field_name</p></th>
<th class="head"><p>field_type</p></th>
<th class="head"><p>count</p></th>
<th class="head"><p>field_title</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>platforms</p></td>
<td><p>_link</p></td>
<td><p>text</p></td>
<td><p>3</p></td>
<td><p>_link</p></td>
</tr>
<tr class="row-odd"><td><p>platforms</p></td>
<td><p>_link_games</p></td>
<td><p>text</p></td>
<td><p>3</p></td>
<td><p>_link_games</p></td>
</tr>
<tr class="row-even"><td><p>platforms</p></td>
<td><p>name</p></td>
<td><p>text</p></td>
<td><p>3</p></td>
<td><p>name</p></td>
</tr>
<tr class="row-odd"><td><p>games</p></td>
<td><p>_link</p></td>
<td><p>text</p></td>
<td><p>2</p></td>
<td><p>_link</p></td>
</tr>
<tr class="row-even"><td><p>games</p></td>
<td><p>id</p></td>
<td><p>number</p></td>
<td><p>2</p></td>
<td><p>id</p></td>
</tr>
</tbody>
</table>
</div>
<p>It can have additional headers in the file but they will not be used. This is true of columns <code class="docutils literal notranslate"><span class="pre">count</span></code> and <code class="docutils literal notranslate"><span class="pre">field_type</span></code> in the above example.</p>
<p>Field order in the output will the same as the row order in the file.</p>
<p><code class="docutils literal notranslate"><span class="pre">table_name</span></code> and <code class="docutils literal notranslate"><span class="pre">field_name</span></code> need to match up with the eventual structure of output. The easiest make sure of this is to edit the <code class="docutils literal notranslate"><span class="pre">fields.csv</span></code> that is in an output directory.<br />
You can generate just the fields.csv file by <span class="xref myst">not outputting the CSV files</span>.</p>
<p>By default if there are fields in the data that are not in the <code class="docutils literal notranslate"><span class="pre">fields.csv</span></code> they will be added to the output after the defined fields.  Use <a class="reference internal" href="#only-fields"><span class="std std-doc">Only Fields</span></a> to change this behaviour so that field not in the file will be excluded.</p>
<section id="id25">
<h3>CLI Usage<a class="headerlink" href="#id25" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--fields<span class="w"> </span>fields.csv
</pre></div>
</div>
</section>
<section id="id26">
<h3>Python Usage<a class="headerlink" href="#id26" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s1">&#39;fields.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="only-fields">
<h2>Only Fields<a class="headerlink" href="#only-fields" title="Permalink to this heading">#</a></h2>
<p>Only fields in the fields.csv file will be in the output.</p>
<section id="id27">
<h3>CLI Usage<a class="headerlink" href="#id27" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--fields<span class="w"> </span>fields.csv<span class="w"> </span>--only-fields
</pre></div>
</div>
</section>
<section id="id28">
<h3>Python Usage<a class="headerlink" href="#id28" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="s1">&#39;fields.csv&#39;</span><span class="p">,</span> <span class="n">only_fields</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="tables-file">
<h2>Tables File<a class="headerlink" href="#tables-file" title="Permalink to this heading">#</a></h2>
<p>Path to tables CSV file.  The file can be used for:</p>
<ul class="simple">
<li><p>Changing the sheet order in xlsx output.</p></li>
<li><p>Giving the tables (and xlsx sheets) a new name by using <code class="docutils literal notranslate"><span class="pre">table_title</span></code></p></li>
<li><p>Removing unwanted tables when using the <a class="reference internal" href="#only-tables"><span class="std std-doc">Only Tables</span></a> option.</p></li>
</ul>
<p>The CSV file needs the following headers:</p>
<ul class="simple">
<li><p>table_name</p></li>
<li><p>table_title</p></li>
</ul>
<p>For example:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>table_name</p></th>
<th class="head"><p>table_title</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>platforms</p></td>
<td><p>_link</p></td>
</tr>
<tr class="row-odd"><td><p>games</p></td>
<td><p>_link</p></td>
</tr>
</tbody>
</table>
</div>
<p>It can have additional headers in the file but they will not be used.</p>
<p><code class="docutils literal notranslate"><span class="pre">tables_name</span></code> has to be the name that would be output by <code class="docutils literal notranslate"><span class="pre">flatterer</span></code>.  To make sure that these names are correct it is best to use the <code class="docutils literal notranslate"><span class="pre">tables.csv</span></code> that is always in the output directory as an basis for modifying the output.</p>
<p>By default if there are tables in the data that are not in the <code class="docutils literal notranslate"><span class="pre">tabless.csv</span></code> they will be added to the output after the defined tables.  Use <a class="reference internal" href="#only-tables"><span class="std std-doc">Only Tables</span></a> to change this behaviour so that only tables in this file will be output.</p>
<section id="id29">
<h3>CLI Usage<a class="headerlink" href="#id29" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--tables<span class="w"> </span>tables.csv
</pre></div>
</div>
</section>
<section id="id30">
<h3>Python Usage<a class="headerlink" href="#id30" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="s1">&#39;tables.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="only-tables">
<h2>Only Tables<a class="headerlink" href="#only-tables" title="Permalink to this heading">#</a></h2>
<p>Only tables in the tables.csv file will be in the output.</p>
<section id="id31">
<h3>CLI Usage<a class="headerlink" href="#id31" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--tables<span class="w"> </span>tables.csv<span class="w"> </span>--only-tables
</pre></div>
</div>
</section>
<section id="id32">
<h3>Python Usage<a class="headerlink" href="#id32" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="s1">&#39;tables.csv&#39;</span><span class="p">,</span> <span class="n">only_tables</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="inline-one-to-one">
<h2>Inline One To One<a class="headerlink" href="#inline-one-to-one" title="Permalink to this heading">#</a></h2>
<p>When a key has an array of objects as its value, but that array only ever has single items in it, then treat it these single item as if they are a sub-object (not sub array).<br />
Without this set any array of objects will be treated like a one-to-many relationship and therefore have a new table associated with it.  With this set and if all arrays under a particular key only have one item in it, the child table will not be created and the values will appear in the parent table.</p>
<section id="id33">
<h3>CLI Usage<a class="headerlink" href="#id33" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--inline-one-to-one
</pre></div>
</div>
</section>
<section id="id34">
<h3>Python Usage<a class="headerlink" href="#id34" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">inline_one_to_one</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="arrays-as-table">
<h2>Arrays as Table<a class="headerlink" href="#arrays-as-table" title="Permalink to this heading">#</a></h2>
<p>Always create a new table for all arrays, even if they do not contain objects.  A new table is created with just the <code class="docutils literal notranslate"><span class="pre">_link</span></code> fields and a column named <code class="docutils literal notranslate"><span class="pre">value</span></code> which contains the value of the item in the array.  If the array item is a string that value will go in the output, for all other types the JSON encoded version of that type is included.</p>
<section id="id35">
<h3>CLI Usage<a class="headerlink" href="#id35" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--arrays-as-table
</pre></div>
</div>
</section>
<section id="id36">
<h3>Python Usage<a class="headerlink" href="#id36" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">arrays_as_table</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

</pre></div>
</div>
</section>
</section>
<section id="schema">
<h2>Schema<a class="headerlink" href="#schema" title="Permalink to this heading">#</a></h2>
<p>Supply a JSONSchema file to help determine field ordering of the output.  If the schema supplied starts with <code class="docutils literal notranslate"><span class="pre">http</span></code> will try and download the schema from a remote server, otherwise it is assumed to be a file-system path.</p>
<section id="id37">
<h3>CLI Usage<a class="headerlink" href="#id37" title="Permalink to this heading">#</a></h3>
<p>For remote url:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--schema<span class="w"> </span>https://example.com/schema.json
</pre></div>
</div>
<p>For local file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--schema<span class="w"> </span>schema.json
</pre></div>
</div>
</section>
<section id="id38">
<h3>Python Usage<a class="headerlink" href="#id38" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s1">&#39;https://example.com/schema.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="table-prefix">
<h2>Table Prefix<a class="headerlink" href="#table-prefix" title="Permalink to this heading">#</a></h2>
<p>Prefix to add to all table names. So if the output has a table called <code class="docutils literal notranslate"><span class="pre">mytable</span></code> and the “table prefix” is specified as <code class="docutils literal notranslate"><span class="pre">myprefix_</span></code> then the table (therefore csv file or excel sheet name) will be called <code class="docutils literal notranslate"><span class="pre">myprefix_mytable</span></code>.<br />
This can be useful if you are trying to namespace the output when inserting into an exiting database.</p>
<section id="id39">
<h3>CLI Usage<a class="headerlink" href="#id39" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--table-prefix<span class="w"> </span>myprefix_
</pre></div>
</div>
</section>
<section id="id40">
<h3>Python Usage<a class="headerlink" href="#id40" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">table_prefix</span><span class="o">=</span><span class="s1">&#39;myprefix_&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="path-separator">
<h2>Path Separator<a class="headerlink" href="#path-separator" title="Permalink to this heading">#</a></h2>
<p>By default all table and field names have <code class="docutils literal notranslate"><span class="pre">_</span></code> as the seperator which denotes a that the field after the <code class="docutils literal notranslate"><span class="pre">_</span></code> is a sub-property. For example <code class="docutils literal notranslate"><span class="pre">myObject_myField</span></code> says that <code class="docutils literal notranslate"><span class="pre">myField</span></code> exists as a property of <code class="docutils literal notranslate"><span class="pre">myObject</span></code>.</p>
<p>However some data already has <code class="docutils literal notranslate"><span class="pre">_</span></code> in the property names.  For example if in the input data theres was an object called <code class="docutils literal notranslate"><span class="pre">my_object</span></code> and the property called <code class="docutils literal notranslate"><span class="pre">my_field</span></code> then by default the field name would be <code class="docutils literal notranslate"><span class="pre">my_object_my_field</span></code>.  This is confusing as you might expect <code class="docutils literal notranslate"><span class="pre">object</span></code> to be a property of <code class="docutils literal notranslate"><span class="pre">my</span></code> and it might cause some name clashes.</p>
<p>To fix this you can change the path separator to whatever you like. You could choose <code class="docutils literal notranslate"><span class="pre">___</span></code> as a separator, so in the example above, the field would be called <code class="docutils literal notranslate"><span class="pre">my_object__my_field</span></code>.</p>
<section id="id41">
<h3>CLI Usage<a class="headerlink" href="#id41" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--path-separator<span class="w"> </span>__
</pre></div>
</div>
</section>
<section id="id42">
<h3>Python Usage<a class="headerlink" href="#id42" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">path_separoator</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="schema-titles">
<h2>Schema Titles<a class="headerlink" href="#schema-titles" title="Permalink to this heading">#</a></h2>
<p>When supplying a JSONSchema then use the <code class="docutils literal notranslate"><span class="pre">title</span></code> field in the schema for the field name (if it exists).  This option takes a string which can be one of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">full</span></code> Use make the <code class="docutils literal notranslate"><span class="pre">title</span></code> field from JSONSchema without modification.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">slug</span></code> use the <code class="docutils literal notranslate"><span class="pre">title</span></code> field but slugify it removing all charactors that are non alphanumeric characters, lower casing and replaceing spaces with <code class="docutils literal notranslate"><span class="pre">-</span></code>.  For example <code class="docutils literal notranslate"><span class="pre">My</span> <span class="pre">*&amp;*Strange</span>&#160;&#160; <span class="pre">Title</span></code> will turn into <code class="docutils literal notranslate"><span class="pre">my-strange-title</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">underscore_slug</span></code> same as slug but uses <code class="docutils literal notranslate"><span class="pre">_</span></code> instead of <code class="docutils literal notranslate"><span class="pre">-</span></code>. The previous example the output would be <code class="docutils literal notranslate"><span class="pre">my_strange_title</span></code></p></li>
</ul>
<p>If this option is left out or is the empty string then it will not take the heading from JSONSchema.</p>
<section id="id43">
<h3>CLI Usage<a class="headerlink" href="#id43" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--schema-titles<span class="w"> </span>underscore_slug
</pre></div>
</div>
</section>
<section id="id44">
<h3>Python Usage<a class="headerlink" href="#id44" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.jl&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">schema_titles</span><span class="o">=</span><span class="s1">&#39;underscore_slug_&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="stats">
<h2>Stats<a class="headerlink" href="#stats" title="Permalink to this heading">#</a></h2>
<p>Adds additional statistics about the output files in the <code class="docutils literal notranslate"><span class="pre">datapackage.json</span></code> output.</p>
<section id="id45">
<h3>CLI Usage<a class="headerlink" href="#id45" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--stats
</pre></div>
</div>
</section>
<section id="id46">
<h3>Python Usage<a class="headerlink" href="#id46" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="preview">
<h2>Preview<a class="headerlink" href="#preview" title="Permalink to this heading">#</a></h2>
<p>The number of rows written in final files. All statistics in <code class="docutils literal notranslate"><span class="pre">fields.csv</span></code> and <code class="docutils literal notranslate"><span class="pre">datapackage.json</span></code> will show counts related to <em>all</em> the data.</p>
<section id="id47">
<h3>CLI Usage<a class="headerlink" href="#id47" title="Permalink to this heading">#</a></h3>
<p>Only output first 10 lines of all the tables.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--preview<span class="w"> </span><span class="m">10</span>
</pre></div>
</div>
</section>
<section id="id48">
<h3>Python Usage<a class="headerlink" href="#id48" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">preview</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="threads">
<h2>Threads<a class="headerlink" href="#threads" title="Permalink to this heading">#</a></h2>
<p>The number of threads used to process the data. Default to 1. If set to 0 will use amount of CPUs.</p>
<p>Works best with new line delimited JSON <code class="docutils literal notranslate"><span class="pre">--ndjson</span></code> as JSON parsing can then be done by each thread. This can about a x3 times improvement with 6 threads if you have that many CPU cores. Without <code class="docutils literal notranslate"><span class="pre">--ndjson</span></code> makes only about x1.24 improvement on 2 threads and not worth going over 2 as it will not lead to performance improvement. For very small datasets (less than 100 object) using threads will most likely be slower.</p>
<p><strong>Warning:</strong> When using this mode, not checks will be done to ensure an array of objects exists in the data. So in some circumstances, if the wrong options are chosen, no error will be raised.</p>
<p><strong>Warning:</strong> May have issues with inline-one-to-one as each thread will determine what should be inlined.</p>
<section id="id49">
<h3>CLI Usage<a class="headerlink" href="#id49" title="Permalink to this heading">#</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>flatterer<span class="w"> </span>INPUT_FILE<span class="w"> </span>OUTPUT_DIRECTORY<span class="w"> </span>--threads<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</section>
<section id="id50">
<h3>Python Usage<a class="headerlink" href="#id50" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">threads</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="sql-scripts">
<h2>Sql Scripts<a class="headerlink" href="#sql-scripts" title="Permalink to this heading">#</a></h2>
<p>Python only. Export scripts for importing data into the database.</p>
<section id="id51">
<h3>Python Usage<a class="headerlink" href="#id51" title="Permalink to this heading">#</a></h3>
<p>flatterer.flatten(‘inputfile.json’, ‘ouput_dir’, sql_scripts=True)</p>
</section>
</section>
<section id="low-memory-api-only">
<h2>Low Memory (api only)<a class="headerlink" href="#low-memory-api-only" title="Permalink to this heading">#</a></h2>
<p>Reduces memory usage, sacrificing some speed.  Use this if JSON contains very large JSON objects.</p>
<section id="id52">
<h3>Python Usage<a class="headerlink" href="#id52" title="Permalink to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">flatterer</span>

<span class="n">flatterer</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;inputfile.json&#39;</span><span class="p">,</span> <span class="s1">&#39;ouput_dir&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="library.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Python Library</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2021-2022, David Raznick
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Option Reference</a><ul>
<li><a class="reference internal" href="#help-small-cli-only-small">Help <small> (CLI Only) </small></a></li>
<li><a class="reference internal" href="#output-formats">Output Formats</a><ul>
<li><a class="reference internal" href="#cli-usage">CLI Usage</a></li>
<li><a class="reference internal" href="#python-usage">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#main-table-name">Main Table Name</a><ul>
<li><a class="reference internal" href="#id1">CLI Usage</a></li>
<li><a class="reference internal" href="#id2">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pushdown-fields">Pushdown Fields</a><ul>
<li><a class="reference internal" href="#id3">CLI Usage</a></li>
<li><a class="reference internal" href="#id4">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#no-link-fields">No Link Fields</a><ul>
<li><a class="reference internal" href="#id5">CLI Usage</a></li>
<li><a class="reference internal" href="#id6">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#path-to-json-array">Path to JSON Array</a><ul>
<li><a class="reference internal" href="#id7">CLI Usage</a></li>
<li><a class="reference internal" href="#id8">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#new-line-delemited-json-ndjson">New Line Delemited JSON (NDJSON)</a><ul>
<li><a class="reference internal" href="#id9">CLI Usage</a></li>
<li><a class="reference internal" href="#id10">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#json-stream">JSON Stream</a><ul>
<li><a class="reference internal" href="#id11">CLI Usage</a></li>
<li><a class="reference internal" href="#id12">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#json-path-filter">JSON Path Filter</a><ul>
<li><a class="reference internal" href="#id13">CLI Usage</a></li>
<li><a class="reference internal" href="#id14">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#force">Force</a><ul>
<li><a class="reference internal" href="#id15">CLI Usage</a></li>
<li><a class="reference internal" href="#id16">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#postgres-schema">Postgres Schema</a><ul>
<li><a class="reference internal" href="#id17">CLI Usage</a></li>
<li><a class="reference internal" href="#id18">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#evolve-tables">Evolve Tables</a><ul>
<li><a class="reference internal" href="#id19">CLI Usage</a></li>
<li><a class="reference internal" href="#id20">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#drop-tables">Drop Tables</a><ul>
<li><a class="reference internal" href="#id21">CLI Usage</a></li>
<li><a class="reference internal" href="#id22">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#truncate-tables">Truncate Tables</a><ul>
<li><a class="reference internal" href="#id23">CLI Usage</a></li>
<li><a class="reference internal" href="#id24">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fields-file">Fields File</a><ul>
<li><a class="reference internal" href="#id25">CLI Usage</a></li>
<li><a class="reference internal" href="#id26">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#only-fields">Only Fields</a><ul>
<li><a class="reference internal" href="#id27">CLI Usage</a></li>
<li><a class="reference internal" href="#id28">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tables-file">Tables File</a><ul>
<li><a class="reference internal" href="#id29">CLI Usage</a></li>
<li><a class="reference internal" href="#id30">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#only-tables">Only Tables</a><ul>
<li><a class="reference internal" href="#id31">CLI Usage</a></li>
<li><a class="reference internal" href="#id32">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inline-one-to-one">Inline One To One</a><ul>
<li><a class="reference internal" href="#id33">CLI Usage</a></li>
<li><a class="reference internal" href="#id34">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#arrays-as-table">Arrays as Table</a><ul>
<li><a class="reference internal" href="#id35">CLI Usage</a></li>
<li><a class="reference internal" href="#id36">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schema">Schema</a><ul>
<li><a class="reference internal" href="#id37">CLI Usage</a></li>
<li><a class="reference internal" href="#id38">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#table-prefix">Table Prefix</a><ul>
<li><a class="reference internal" href="#id39">CLI Usage</a></li>
<li><a class="reference internal" href="#id40">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#path-separator">Path Separator</a><ul>
<li><a class="reference internal" href="#id41">CLI Usage</a></li>
<li><a class="reference internal" href="#id42">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#schema-titles">Schema Titles</a><ul>
<li><a class="reference internal" href="#id43">CLI Usage</a></li>
<li><a class="reference internal" href="#id44">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stats">Stats</a><ul>
<li><a class="reference internal" href="#id45">CLI Usage</a></li>
<li><a class="reference internal" href="#id46">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#preview">Preview</a><ul>
<li><a class="reference internal" href="#id47">CLI Usage</a></li>
<li><a class="reference internal" href="#id48">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#threads">Threads</a><ul>
<li><a class="reference internal" href="#id49">CLI Usage</a></li>
<li><a class="reference internal" href="#id50">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sql-scripts">Sql Scripts</a><ul>
<li><a class="reference internal" href="#id51">Python Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#low-memory-api-only">Low Memory (api only)</a><ul>
<li><a class="reference internal" href="#id52">Python Usage</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>